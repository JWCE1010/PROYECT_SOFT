<!DOCTYPE html>
<html lang="es">

<head>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/worker.js')
                .then(function (registration) {
                    console.log('Service Worker registrado con éxito:', registration);
                })
                .catch(function (error) {
                    console.log('Error al registrar el Service Worker:', error);
                });
        }
    </script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #loading-screen {
            display: none;
            position: fixed;
            top: 100%;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            text-align: center;
            padding-top: 20%;
            font-size: 24px;
            transition: top 0.5s ease-in-out;
        }

        #loading-screen.active {
            top: 0;
        }

        #loading-image {
            width: 100px;
            height: auto;
        }
    </style>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

</head>

<body>
    <div id="loading-screen">
        <img id="loading-image" src="/img/envase.png" alt="Loading Image"><br>
        Loading...
    </div>
    <main class="index">
        <header class="masthead d-flex">
            <div class="container text-center my-auto">
                <h1 class="mb-1">Administración de tienda de Lubricantes y cambio de aceite</h1>
                <h3 class="mb-5">
                    <em>Administración y Gestión de la tienda</em>
                </h3>
                <div class="row">
                    {{#each productos}}
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="card-title text-uppercase" style="color: black;">
                                    {{name}}
                                </h3>
                                <p class="m-2" style="color: black;">{{precio}} Bs</p>
                                <p class="m-2" style="color: black;">{{description}}</p>
                                <p class="text-muted">
                                    {{timeago created_at}}
                                </p>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>

            </div>
            <div class="overlay"></div>
        </header>
    </main>

    <!-- Footer -->
    <footer class="description">
        <div>
            <h4 class="title">Contacto</h4>
            <p class="paragraph">Somos tu destino confiable para productos de calidad en el mundo de los lubricantes y
                cambios de aceite.
                En Lubricenter, nos dedicamos a brindarte soluciones excepcionales para el mantenimiento de tu
                vehículo, ofreciendo una amplia gama de lubricantes premium y servicios de cambio de aceite.
                Nuestro compromiso es proporcionar productos que mantengan tu motor en óptimas condiciones, asegurando
                un rendimiento confiable y duradero. Con personal experto y un enfoque centrado en el cliente, estamos
                aquí para satisfacer todas tus necesidades automotrices.
                ¡Visítanos y descubre cómo podemos mantener tu vehículo en marcha de manera suave y eficiente!
                Contacto: 73772777</p>
            <div class="social">
                <a href=""><img src="/img/face.png" width="90px" height="70px"></a>
                <a href="https://web.telegram.org/k/#@lubricentrobot"><img src="/img/telegram.png" width="100px"
                        height="80px"></a>
                <a href=""><img src="/img/insta.png" width="90px" height="70px"></a>
                <a href=""><img src="/img/whats.png" width="90px" height="70px"></a>
            </div>
        </div>
        <form action="https://formspree.io/f/mwkdjqzv" method="POST" onsubmit="handleSubmit(event)">
            <input placeholder="Name" type="text" id="names" name="names" required>
            <input placeholder="Email" type="email" id="email" name="email" required>
            <textarea placeholder="Type your message here" id="message" name="message"></textarea>

            <button class="btn btn-primary btn-block">Enviar Comentario</button>
            <p id="message-display"></p>

        </form>
        <script>
            const setMessage = (msg) => {
                document.getElementById('message-display').innerText = msg;
            };

            const handleSubmit = async (event) => {
                event.preventDefault();
                const data = new FormData(event.target);

                try {
                    const response = await fetch(event.target.action, {
                        method: 'POST',
                        body: data,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        setMessage(result.error.map(error => error.message).join(', '));
                        return false;
                    }

                    setMessage('Se ha enviado tu correo');
                    window.location.href = window.location.href;
                    // Eliminé un paréntesis adicional aquí
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 2000);
                } catch (error) {
                    console.error('Error en la solicitud:', error);
                }
            };

        </script>

    </footer>
    <script>
        // Envuelve el código en el evento 'DOMContentLoaded'
        document.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loading-screen');
            const worker = new Worker('worker.js');

            loadingScreen.style.display = 'block';
            loadingScreen.classList.add('active');

            worker.postMessage('Comenzar procesamiento');

            // Manejar el mensaje de vuelta del Web Worker
            worker.addEventListener('message', (event) => {
                loadingScreen.classList.remove('active');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
                console.log(event.data);
            });
        });
    </script>
</body>

</html>